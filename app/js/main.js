angular.module("angularApp",["ngRoute","ui.bootstrap","ngAnimate","highcharts-ng"]);
angular.module("angularApp").config(["$routeProvider",function(e){e.when("/",{templateUrl:"src/home/home.tpl.html",controller:"HomeCtrl",controllerAs:"vm"}).otherwise("/")}]);
angular.module("angularApp").controller("HomeCtrl",["Build","Utils","$q",function(t,e,n){function a(){t.getBuild().then(f.fn.extendBuild).then(f.fn.runNextPendingBuild)}function s(t){var e=angular.copy(f.data.buildDefaults),n=_.extend({},t,e);return f.ui.start=!1,f.data.pending.push(n),f.data.builds.push(n),n}function i(){return f.fn.runBuild().then(f.fn.addMockTestsResults).then(f.fn.analyzeBuild).then(f.fn.addResults).then(f.fn.runNextPendingBuild)}function d(){if(!f.ui.building&&f.data.pending.length>0){var e=f.data.pending.shift();return e.state=f.data.states[1],f.ui.building=!0,t.runBuild(e)}return n.reject("build skipped")}function u(t){for(var n in t.metrics)t.metrics.hasOwnProperty(n)&&(t.metrics[n]=e.randomNumber(100));return t.unitTest.passed=e.randomNumber(t.totalUnitTests),t.unitTest.failed=t.totalUnitTests-t.unitTest.passed,t.unitTest.percent=t.unitTest.passed/t.totalUnitTests*100,t.unitTest.coverage=e.randomNumber(100),t.functionalTest.passed=e.randomNumber(t.totalFunctionalTests),t.functionalTest.failed=t.totalFunctionalTests-t.functionalTest.passed,t.functionalTest.percent=t.functionalTest.passed/t.totalFunctionalTests*100,t.functionalTest.coverage=e.randomNumber(100),t}function l(t){var e,n=t.id-1,a=_.find(f.data.builds,{id:n}),s=t.metrics;return a?(s.testPassed=s.test-a.metrics.test>=0,s.maintainPassed=s.maintainability-a.metrics.maintainability>=0,e=s.testPassed&&s.maintainPassed,e?t.state=f.data.states[2]:t.state=f.data.states[3]):(s.testPassed=!0,s.maintainPassed=!0,t.state=f.data.states[2]),t.chart={unitTest:f.fn.initChart(t.unitTest.passed,t.unitTest.failed),functionalTest:f.fn.initChart(t.functionalTest.passed,t.functionalTest.failed)},t}function r(t){return"rejected"===t.state?t.result=f.data.results[1]:"complete"===t.state&&"firewall"===t.type?t.result=f.data.results[0]:"complete"===t.state&&"build"===t.type&&(t.result=f.data.results[2]),f.ui.building=!1,t}function o(){f.data.builds=[]}function c(t){"pending"!==t.state&&"running"!==t.state&&(f.data.expandedBuild&&t.id===f.data.expandedBuild.id?(t.expanded=!t.expanded,t.showChart=!t.showChart,f.data.expandedBuild=null):(f.data.builds.forEach(function(t){t.expanded=!1,t.showChart=!1}),f.data.expandedBuild=t,t.expanded=!0,t.showChart=!0))}function p(t,e){return{options:{legend:{align:"center",verticalAlign:"bottom",layout:"vertical",useHTML:!0,labelFormatter:function(){return'<span class="legend-wrapper"><span class="text-ellipsis font9 legend-title">'+this.name+'</span> <span class="mute font9">('+this.y+")</span></span>"}},plotOptions:{pie:{point:{events:{legendItemClick:function(){return!1}}},enableMouseTracking:!1,showInLegend:!0,innerSize:"67%",dataLabels:{enabled:!1}}}},size:{height:200},title:{text:""},series:[{type:"pie",data:[{name:"Passed",y:t},{name:"Failed",y:e}]}]}}var f=this;f.data={results:[{status:"merged",subTitle:"Change Accepted",message:"Auto-Merged"},{status:"rejected",subTitle:"Change Rejected",message:"Metrics Reduction"},{status:"complete",subTitle:null,message:"Complete"}],states:["pending","running","complete","rejected"],buildDefaults:{state:"pending",progress:{metrics:0,build:0,unitTest:0,functionalTest:0},expanded:!1,metrics:{test:0,security:0,maintainability:0,workmanship:0},unitTest:{passed:0,failed:0,coverage:0},functionalTest:{passed:0,failed:0,coverage:0},result:null},pending:[],builds:[]},f.ui={building:!1,start:!0},f.fn={addBuild:a,runBuild:d,clearBuilds:o,addMockTestsResults:u,runNextPendingBuild:i,expandBuild:c,initChart:p,extendBuild:s,analyzeBuild:l,addResults:r},a()}]);
angular.module("angularApp").factory("Build",["$q","$timeout","$interval","Utils",function(r,e,t,n){function a(){var t=r.defer();return e(function(){var r=n.getRandomItemFromArray(d),e=n.getRandomItemFromArray(s),a={buildNumber:f,id:"build"===r?u:i,type:r,name:"build"===r?b+"-"+u:i,owner:e,date:moment().format(),build:{lastBuild:moment().subtract(1,"day").format()},totalUnitTests:l,totalFunctionalTests:m};"build"===r?u++:i++,f++,t.resolve(a)},500),t.promise}function o(e){function n(r){var u,i;if(!(r<o.length))return a.resolve(e);var l=t(function(){return u=e.progress[o[r]],i=o[r],100>u?e.progress[i]+=1:(t.cancel(l),n(r+1))},10)}var a=r.defer(),o=Object.keys(e.progress);return n(0),a.promise}var u=n.randomNumber(1e4),i=n.randomNumber(1e4),l=n.randomNumber(100),m=n.randomNumber(1e3),d=["build","firewall"],s=["alex","joe","adi","william"],b="rainman",f=0;return{getBuild:a,runBuild:o}}]);
angular.module("angularApp").factory("Utils",function(){function r(r){var n=a.randomNumber(r.length-1);return r[n]}function n(r){return Math.round(Math.random()*r)}var a={randomNumber:n,getRandomItemFromArray:r};return a});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlcy5qcyIsImhvbWUvaG9tZS5qcyIsInNlcnZpY2VzL2J1aWxkLmpzIiwic2VydmljZXMvdXRpbHMuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsImNvbnRyb2xsZXJBcyIsIm90aGVyd2lzZSIsIkJ1aWxkIiwiVXRpbHMiLCIkcSIsImFkZEJ1aWxkIiwiZ2V0QnVpbGQiLCJ0aGVuIiwidm0iLCJmbiIsImV4dGVuZEJ1aWxkIiwicnVuTmV4dFBlbmRpbmdCdWlsZCIsImJ1aWxkUmVzcG9uc2UiLCJkZWZhdWx0cyIsImNvcHkiLCJkYXRhIiwiYnVpbGREZWZhdWx0cyIsImJ1aWxkIiwiXyIsImV4dGVuZCIsInVpIiwic3RhcnQiLCJwZW5kaW5nIiwicHVzaCIsImJ1aWxkcyIsInJ1bkJ1aWxkIiwiYWRkTW9ja1Rlc3RzUmVzdWx0cyIsImFuYWx5emVCdWlsZCIsImFkZFJlc3VsdHMiLCJidWlsZGluZyIsImxlbmd0aCIsImFjdGl2ZUJ1aWxkIiwic2hpZnQiLCJzdGF0ZSIsInN0YXRlcyIsInJlamVjdCIsImtleSIsIm1ldHJpY3MiLCJoYXNPd25Qcm9wZXJ0eSIsInJhbmRvbU51bWJlciIsInVuaXRUZXN0IiwicGFzc2VkIiwidG90YWxVbml0VGVzdHMiLCJmYWlsZWQiLCJwZXJjZW50IiwiY292ZXJhZ2UiLCJmdW5jdGlvbmFsVGVzdCIsInRvdGFsRnVuY3Rpb25hbFRlc3RzIiwidGVzdHNQYXNzZWQiLCJsYXN0QnVpbGRJZCIsImlkIiwibGFzdEJ1aWxkIiwiZmluZCIsInRlc3RQYXNzZWQiLCJ0ZXN0IiwibWFpbnRhaW5QYXNzZWQiLCJtYWludGFpbmFiaWxpdHkiLCJjaGFydCIsImluaXRDaGFydCIsInJlc3VsdCIsInJlc3VsdHMiLCJ0eXBlIiwiY2xlYXJCdWlsZHMiLCJleHBhbmRCdWlsZCIsImV4cGFuZGVkQnVpbGQiLCJleHBhbmRlZCIsInNob3dDaGFydCIsImZvckVhY2giLCJvcHRpb25zIiwibGVnZW5kIiwiYWxpZ24iLCJ2ZXJ0aWNhbEFsaWduIiwibGF5b3V0IiwidXNlSFRNTCIsImxhYmVsRm9ybWF0dGVyIiwidGhpcyIsIm5hbWUiLCJ5IiwicGxvdE9wdGlvbnMiLCJwaWUiLCJwb2ludCIsImV2ZW50cyIsImxlZ2VuZEl0ZW1DbGljayIsImVuYWJsZU1vdXNlVHJhY2tpbmciLCJzaG93SW5MZWdlbmQiLCJpbm5lclNpemUiLCJkYXRhTGFiZWxzIiwiZW5hYmxlZCIsInNpemUiLCJoZWlnaHQiLCJ0aXRsZSIsInRleHQiLCJzZXJpZXMiLCJzdGF0dXMiLCJzdWJUaXRsZSIsIm1lc3NhZ2UiLCJwcm9ncmVzcyIsInNlY3VyaXR5Iiwid29ya21hbnNoaXAiLCJmYWN0b3J5IiwiJHRpbWVvdXQiLCIkaW50ZXJ2YWwiLCJkZWZlcnJlZCIsImRlZmVyIiwiZ2V0UmFuZG9tSXRlbUZyb21BcnJheSIsInR5cGVzIiwib3duZXIiLCJvd25lcnMiLCJidWlsZE51bWJlciIsImJ1aWxkbnVtYmVyIiwiYnVpbGRJZCIsImZpcmVXYWxsSWQiLCJidWlsZE5hbWUiLCJkYXRlIiwibW9tZW50IiwiZm9ybWF0Iiwic3VidHJhY3QiLCJyZXNvbHZlIiwicHJvbWlzZSIsInJ1blNpbXVsYXRlZFByb2dyZXNzIiwiaW5kZXgiLCJhY3RpdmVQcm9ncmVzc1BlcmNlbnQiLCJhY3RpdmVQcm9ncmVzcyIsImtleXMiLCJwcm9ncmVzc0ludGVydmFsIiwiY2FuY2VsIiwiT2JqZWN0IiwiYXJyYXkiLCJudW1iZXIiLCJNYXRoIiwicm91bmQiLCJyYW5kb20iXSwibWFwcGluZ3MiOiJBQUFBQSxRQUFRQyxPQUFPLGNBQ2IsVUFDQSxlQUNBLFlBQ0E7QUNKRkQsUUFBUUMsT0FBTyxjQUFjQyxRQUFBLGlCQUFPLFNBQVNDLEdBQzNDQSxFQUVDQyxLQUFLLEtBQ0pDLFlBQWEseUJBQ2JDLFdBQVksV0FDWkMsYUFBYyxPQUdmQyxV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QUMzQ2tFLEdBQXlCLFFBQVEsWUFDakNFLEdBQXlCLE9BQU8sTUFBTyxNQUFPLFdBQzlDSyxFQUF3QixVQUN4QkgsRUFBd0IsQ0FFMUIsUUFDRXZHLFNBQVVBLEVBQ1ZtQixTQUFVQTtBQ2xCZGhDLFFBQVFDLE9BQU8sY0FBY3lHLFFBQVEsUUFBUyxXQVE1QyxRQUFTSyxHQUF1QnVCLEdBQzlCLEdBQUl4RixHQUFlOUIsRUFBRzhCLGFBQWF3RixFQUFNakcsT0FBTyxFQUNoRCxPQUFPaUcsR0FBTXhGLEdBRWYsUUFBU0EsR0FBYXlGLEdBQ3BCLE1BQU9DLE1BQUtDLE1BQU1ELEtBQUtFLFNBQVNILEdBWmpDLEdBQUl2SCxJQUNIOEIsYUFBY0EsRUFDZGlFLHVCQUF3QkEsRUFHMUIsT0FBTy9GIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnYW5ndWxhckFwcCcsIFtcbiAgJ25nUm91dGUnLFxuICAndWkuYm9vdHN0cmFwJyxcbiAgJ25nQW5pbWF0ZScsXG4gICdoaWdoY2hhcnRzLW5nJ1xuXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYW5ndWxhckFwcCcpLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlcikge1xuICAkcm91dGVQcm92aWRlclxuXG4gIC53aGVuKCcvJywge1xuICAgIHRlbXBsYXRlVXJsOiAnc3JjL2hvbWUvaG9tZS50cGwuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0hvbWVDdHJsJyxcbiAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgfSlcblxuICAub3RoZXJ3aXNlKCcvJyk7XG5cbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXJBcHAnKS5jb250cm9sbGVyKCdIb21lQ3RybCcsXG4gIGZ1bmN0aW9uKFxuICAgIEJ1aWxkLFxuICAgIFV0aWxzLFxuICAgICRxXG4gICl7XG4gICAgdmFyIHZtID0gdGhpcztcblxuICAgIHZtLmRhdGEgPSB7XG4gICAgICByZXN1bHRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6ICdtZXJnZWQnLFxuICAgICAgICAgIHN1YlRpdGxlOiAnQ2hhbmdlIEFjY2VwdGVkJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0by1NZXJnZWQnXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6ICdyZWplY3RlZCcsXG4gICAgICAgICAgc3ViVGl0bGU6ICdDaGFuZ2UgUmVqZWN0ZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdNZXRyaWNzIFJlZHVjdGlvbidcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogJ2NvbXBsZXRlJyxcbiAgICAgICAgICBzdWJUaXRsZTogbnVsbCxcbiAgICAgICAgICBtZXNzYWdlOiAnQ29tcGxldGUnXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgc3RhdGVzOiBbXG4gICAgICAgICdwZW5kaW5nJyxcbiAgICAgICAgJ3J1bm5pbmcnLFxuICAgICAgICAnY29tcGxldGUnLFxuICAgICAgICAncmVqZWN0ZWQnXG4gICAgICBdLFxuICAgICAgYnVpbGREZWZhdWx0czoge1xuICAgICAgICBzdGF0ZTogJ3BlbmRpbmcnLFxuICAgICAgICBwcm9ncmVzczoge1xuICAgICAgICAgIG1ldHJpY3M6IDAsXG4gICAgICAgICAgYnVpbGQ6IDAsXG4gICAgICAgICAgdW5pdFRlc3Q6IDAsXG4gICAgICAgICAgZnVuY3Rpb25hbFRlc3Q6IDBcbiAgICAgICAgfSxcbiAgICAgICAgZXhwYW5kZWQ6ZmFsc2UsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICB0ZXN0OjAsXG4gICAgICAgICAgc2VjdXJpdHk6MCxcbiAgICAgICAgICBtYWludGFpbmFiaWxpdHk6MCxcbiAgICAgICAgICB3b3JrbWFuc2hpcDowXG4gICAgICAgIH0sXG4gICAgICAgIHVuaXRUZXN0OiB7XG4gICAgICAgICAgcGFzc2VkOiAwLFxuICAgICAgICAgIGZhaWxlZDogMCxcbiAgICAgICAgICBjb3ZlcmFnZTogMCxcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb25hbFRlc3Q6IHtcbiAgICAgICAgICBwYXNzZWQ6IDAsXG4gICAgICAgICAgZmFpbGVkOiAwLFxuICAgICAgICAgIGNvdmVyYWdlOiAwXG4gICAgICAgIH0sXG4gICAgICAgIHJlc3VsdDogbnVsbFxuICAgICAgfSxcbiAgICAgIHBlbmRpbmc6IFtdLFxuICAgICAgYnVpbGRzOiBbXVxuICAgIH07XG5cbiAgICB2bS51aSAgID0ge1xuICAgICAgYnVpbGRpbmc6IGZhbHNlLFxuICAgICAgc3RhcnQ6IHRydWVcbiAgICB9O1xuXG4gICAgdm0uZm4gICA9IHtcbiAgICAgIGFkZEJ1aWxkICAgICAgICAgICAgOiBhZGRCdWlsZCxcbiAgICAgIHJ1bkJ1aWxkICAgICAgICAgICAgOiBydW5CdWlsZCxcbiAgICAgIGNsZWFyQnVpbGRzICAgICAgICAgOiBjbGVhckJ1aWxkcyxcbiAgICAgIGFkZE1vY2tUZXN0c1Jlc3VsdHMgOiBhZGRNb2NrVGVzdHNSZXN1bHRzLFxuICAgICAgcnVuTmV4dFBlbmRpbmdCdWlsZCA6IHJ1bk5leHRQZW5kaW5nQnVpbGQsXG4gICAgICBleHBhbmRCdWlsZCAgICAgICAgIDogZXhwYW5kQnVpbGQsXG4gICAgICBpbml0Q2hhcnQgICAgICAgICAgIDogaW5pdENoYXJ0LFxuICAgICAgZXh0ZW5kQnVpbGQgICAgICAgICA6IGV4dGVuZEJ1aWxkLFxuICAgICAgYW5hbHl6ZUJ1aWxkICAgICAgICA6IGFuYWx5emVCdWlsZCxcbiAgICAgIGFkZFJlc3VsdHMgICAgICAgICAgOiBhZGRSZXN1bHRzXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGFkZEJ1aWxkKCkge1xuICAgICAgQnVpbGQuZ2V0QnVpbGQoKVxuICAgICAgLnRoZW4odm0uZm4uZXh0ZW5kQnVpbGQpXG4gICAgICAudGhlbih2bS5mbi5ydW5OZXh0UGVuZGluZ0J1aWxkKTtcbiAgICB9XG5cbiAgICAvL2V4dGVuZCB0aGUgYnVpbGQgcmVzcG9uc2Ugd2l0aCB2YWx1ZXMgbmVlZGVkIGZvciBwcm9jZXNzaW5nXG4gICAgZnVuY3Rpb24gZXh0ZW5kQnVpbGQoYnVpbGRSZXNwb25zZSkge1xuICAgICAgdmFyXG4gICAgICAgIGRlZmF1bHRzICAgICAgICAgICAgICAgICAgICA9IGFuZ3VsYXIuY29weSh2bS5kYXRhLmJ1aWxkRGVmYXVsdHMpLFxuICAgICAgICBidWlsZCAgICAgICAgICAgICAgICAgICAgICAgPSBfLmV4dGVuZCh7fSwgYnVpbGRSZXNwb25zZSwgZGVmYXVsdHMpO1xuICAgICAgdm0udWkuc3RhcnQgPSBmYWxzZTtcbiAgICAgIHZtLmRhdGEucGVuZGluZy5wdXNoKGJ1aWxkKTtcbiAgICAgIHZtLmRhdGEuYnVpbGRzLnB1c2goYnVpbGQpO1xuXG4gICAgICByZXR1cm4gYnVpbGQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcnVuTmV4dFBlbmRpbmdCdWlsZCgpIHtcbiAgICAgIHJldHVybiB2bS5mbi5ydW5CdWlsZCgpXG4gICAgICAudGhlbih2bS5mbi5hZGRNb2NrVGVzdHNSZXN1bHRzKVxuICAgICAgLnRoZW4odm0uZm4uYW5hbHl6ZUJ1aWxkKVxuICAgICAgLnRoZW4odm0uZm4uYWRkUmVzdWx0cylcbiAgICAgIC50aGVuKHZtLmZuLnJ1bk5leHRQZW5kaW5nQnVpbGQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJ1bkJ1aWxkKCl7XG4gICAgICBpZiAoIXZtLnVpLmJ1aWxkaW5nICYmIHZtLmRhdGEucGVuZGluZy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciBhY3RpdmVCdWlsZCAgICAgICAgICAgICA9IHZtLmRhdGEucGVuZGluZy5zaGlmdCgpO1xuXG4gICAgICAgIGFjdGl2ZUJ1aWxkLnN0YXRlICAgICAgICAgICA9IHZtLmRhdGEuc3RhdGVzWzFdO1xuICAgICAgICB2bS51aS5idWlsZGluZyAgICAgICAgICAgICAgPSB0cnVlO1xuICAgICAgICByZXR1cm4gQnVpbGQucnVuQnVpbGQoYWN0aXZlQnVpbGQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICRxLnJlamVjdCgnYnVpbGQgc2tpcHBlZCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZE1vY2tUZXN0c1Jlc3VsdHMgKGJ1aWxkKSB7XG4gICAgICAvL21vY2sgcmVzdWx0cyBmb3IgbWV0cmljc1xuICAgICAgZm9yICh2YXIga2V5IGluIGJ1aWxkLm1ldHJpY3MpIHtcbiAgICAgICAgaWYgKGJ1aWxkLm1ldHJpY3MuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgIGJ1aWxkLm1ldHJpY3Nba2V5XSAgICAgICAgPSBVdGlscy5yYW5kb21OdW1iZXIoMTAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvL21vY2sgcmVzdWx0cyBmb3IgdW5pdFRlc3RcbiAgICAgIGJ1aWxkLnVuaXRUZXN0LnBhc3NlZCAgICAgICAgID0gVXRpbHMucmFuZG9tTnVtYmVyKGJ1aWxkLnRvdGFsVW5pdFRlc3RzKTtcbiAgICAgIGJ1aWxkLnVuaXRUZXN0LmZhaWxlZCAgICAgICAgID0gYnVpbGQudG90YWxVbml0VGVzdHMgLSBidWlsZC51bml0VGVzdC5wYXNzZWQ7XG4gICAgICBidWlsZC51bml0VGVzdC5wZXJjZW50ICAgICAgICA9IGJ1aWxkLnVuaXRUZXN0LnBhc3NlZC9idWlsZC50b3RhbFVuaXRUZXN0cyAqIDEwMDtcbiAgICAgIGJ1aWxkLnVuaXRUZXN0LmNvdmVyYWdlICAgICAgID0gVXRpbHMucmFuZG9tTnVtYmVyKDEwMCk7XG5cbiAgICAgIC8vbW9jayByZXN1bHRzIGZvciBmdW5jdGlvbmFsVGVzdFxuICAgICAgYnVpbGQuZnVuY3Rpb25hbFRlc3QucGFzc2VkICAgPSBVdGlscy5yYW5kb21OdW1iZXIoYnVpbGQudG90YWxGdW5jdGlvbmFsVGVzdHMpO1xuICAgICAgYnVpbGQuZnVuY3Rpb25hbFRlc3QuZmFpbGVkICAgPSBidWlsZC50b3RhbEZ1bmN0aW9uYWxUZXN0cyAtIGJ1aWxkLmZ1bmN0aW9uYWxUZXN0LnBhc3NlZDtcbiAgICAgIGJ1aWxkLmZ1bmN0aW9uYWxUZXN0LnBlcmNlbnQgID0gYnVpbGQuZnVuY3Rpb25hbFRlc3QucGFzc2VkL2J1aWxkLnRvdGFsRnVuY3Rpb25hbFRlc3RzICogMTAwO1xuICAgICAgYnVpbGQuZnVuY3Rpb25hbFRlc3QuY292ZXJhZ2UgPSBVdGlscy5yYW5kb21OdW1iZXIoMTAwKTtcbiAgICAgIHJldHVybiBidWlsZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhbmFseXplQnVpbGQoYWN0aXZlQnVpbGQpe1xuICAgICAgdmFyXG4gICAgICAgIGxhc3RCdWlsZElkICAgICAgICAgICAgICAgICA9IGFjdGl2ZUJ1aWxkLmlkIC0gMSxcbiAgICAgICAgbGFzdEJ1aWxkICAgICAgICAgICAgICAgICAgID0gXy5maW5kKHZtLmRhdGEuYnVpbGRzLCB7aWQ6IGxhc3RCdWlsZElkfSksXG4gICAgICAgIG1ldHJpY3MgICAgICAgICAgICAgICAgICAgICA9IGFjdGl2ZUJ1aWxkLm1ldHJpY3MsXG4gICAgICAgIHRlc3RzUGFzc2VkO1xuXG4gICAgICBpZiAobGFzdEJ1aWxkKSB7XG4gICAgICAgICAgbWV0cmljcy50ZXN0UGFzc2VkICAgICAgICA9IChtZXRyaWNzLnRlc3QgLSBsYXN0QnVpbGQubWV0cmljcy50ZXN0KSA+PSAwLFxuICAgICAgICAgIG1ldHJpY3MubWFpbnRhaW5QYXNzZWQgICAgPSAobWV0cmljcy5tYWludGFpbmFiaWxpdHkgLSBsYXN0QnVpbGQubWV0cmljcy5tYWludGFpbmFiaWxpdHkpID49IDAsXG5cbiAgICAgICAgICB0ZXN0c1Bhc3NlZCAgICAgICAgICAgICAgID0gKG1ldHJpY3MudGVzdFBhc3NlZCAmJiBtZXRyaWNzLm1haW50YWluUGFzc2VkKTtcblxuICAgICAgICBpZiAodGVzdHNQYXNzZWQpIHtcbiAgICAgICAgICBhY3RpdmVCdWlsZC5zdGF0ZSAgICAgICAgID0gdm0uZGF0YS5zdGF0ZXNbMl07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWN0aXZlQnVpbGQuc3RhdGUgICAgICAgICA9IHZtLmRhdGEuc3RhdGVzWzNdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBmaXJzdCBidWlsZCBvZiBraW5kXG4gICAgICBlbHNlIHtcbiAgICAgICAgbWV0cmljcy50ZXN0UGFzc2VkICAgICAgICAgID0gdHJ1ZSxcbiAgICAgICAgbWV0cmljcy5tYWludGFpblBhc3NlZCAgICAgID0gdHJ1ZSxcbiAgICAgICAgYWN0aXZlQnVpbGQuc3RhdGUgICAgICAgICAgID0gdm0uZGF0YS5zdGF0ZXNbMl07XG4gICAgICB9XG5cbiAgICAgIGFjdGl2ZUJ1aWxkLmNoYXJ0ID0ge1xuICAgICAgICB1bml0VGVzdCAgICAgIDogdm0uZm4uaW5pdENoYXJ0KGFjdGl2ZUJ1aWxkLnVuaXRUZXN0LnBhc3NlZCwgYWN0aXZlQnVpbGQudW5pdFRlc3QuZmFpbGVkKSxcbiAgICAgICAgZnVuY3Rpb25hbFRlc3Q6IHZtLmZuLmluaXRDaGFydChhY3RpdmVCdWlsZC5mdW5jdGlvbmFsVGVzdC5wYXNzZWQsIGFjdGl2ZUJ1aWxkLmZ1bmN0aW9uYWxUZXN0LmZhaWxlZClcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBhY3RpdmVCdWlsZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRSZXN1bHRzKGFjdGl2ZUJ1aWxkKSB7XG4gICAgICBpZiAoYWN0aXZlQnVpbGQuc3RhdGUgICAgICA9PT0gJ3JlamVjdGVkJykge1xuICAgICAgICBhY3RpdmVCdWlsZC5yZXN1bHQgICAgICAgICAgPSB2bS5kYXRhLnJlc3VsdHNbMV07XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChhY3RpdmVCdWlsZC5zdGF0ZSA9PT0gJ2NvbXBsZXRlJyAmJiBhY3RpdmVCdWlsZC50eXBlID09PSAnZmlyZXdhbGwnKSB7XG4gICAgICAgIGFjdGl2ZUJ1aWxkLnJlc3VsdCAgICAgICAgICA9IHZtLmRhdGEucmVzdWx0c1swXTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGFjdGl2ZUJ1aWxkLnN0YXRlID09PSAnY29tcGxldGUnICYmIGFjdGl2ZUJ1aWxkLnR5cGUgPT09ICdidWlsZCcpIHtcbiAgICAgICAgYWN0aXZlQnVpbGQucmVzdWx0ICAgICAgICAgID0gdm0uZGF0YS5yZXN1bHRzWzJdO1xuICAgICAgfVxuICAgICAgdm0udWkuYnVpbGRpbmcgICAgICAgICAgICAgICAgPSBmYWxzZTtcbiAgICAgIHJldHVybiBhY3RpdmVCdWlsZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckJ1aWxkcygpe1xuICAgICAgdm0uZGF0YS5idWlsZHMgICAgICAgICAgICAgICAgPSBbXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBhbmRCdWlsZChidWlsZCkge1xuICAgICAgaWYgKGJ1aWxkLnN0YXRlID09PSAncGVuZGluZycgfHwgYnVpbGQuc3RhdGUgPT09ICdydW5uaW5nJyApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHZtLmRhdGEuZXhwYW5kZWRCdWlsZCAmJiBidWlsZC5pZCA9PT0gdm0uZGF0YS5leHBhbmRlZEJ1aWxkLmlkKSB7XG4gICAgICAgIGJ1aWxkLmV4cGFuZGVkICAgICAgICAgICAgICA9ICFidWlsZC5leHBhbmRlZDtcbiAgICAgICAgYnVpbGQuc2hvd0NoYXJ0ICAgICAgICAgICAgID0gIWJ1aWxkLnNob3dDaGFydDtcbiAgICAgICAgdm0uZGF0YS5leHBhbmRlZEJ1aWxkICAgICAgID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZtLmRhdGEuYnVpbGRzLmZvckVhY2goZnVuY3Rpb24oYnVpbGQpe1xuICAgICAgICAgIGJ1aWxkLmV4cGFuZGVkICAgICAgICAgICAgPSBmYWxzZTtcbiAgICAgICAgICBidWlsZC5zaG93Q2hhcnQgICAgICAgICAgID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZtLmRhdGEuZXhwYW5kZWRCdWlsZCAgICAgICA9IGJ1aWxkO1xuICAgICAgICBidWlsZC5leHBhbmRlZCAgICAgICAgICAgICAgPSB0cnVlO1xuICAgICAgICBidWlsZC5zaG93Q2hhcnQgICAgICAgICAgICAgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXRDaGFydChwYXNzZWQsIGZhaWxlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIGxlZ2VuZDoge1xuICAgICAgICAgICAgYWxpZ24gICAgICAgICAgIDogJ2NlbnRlcicsXG4gICAgICAgICAgICB2ZXJ0aWNhbEFsaWduICAgOiAnYm90dG9tJyxcbiAgICAgICAgICAgIGxheW91dCAgICAgICAgICA6ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICB1c2VIVE1MICAgICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgbGFiZWxGb3JtYXR0ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICAnPHNwYW4gY2xhc3M9XCJsZWdlbmQtd3JhcHBlclwiPjxzcGFuIGNsYXNzPVwidGV4dC1lbGxpcHNpcyBmb250OSBsZWdlbmQtdGl0bGVcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hbWUgK1xuICAgICAgICAgICAgICAgICAgICAgICc8L3NwYW4+JyArXG4gICAgICAgICAgICAgICAgICAgICAgJyA8c3BhbiBjbGFzcz1cIm11dGUgZm9udDlcIj4oJyArXG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy55ICtcbiAgICAgICAgICAgICAgICAgICAgICAnKTwvc3Bhbj48L3NwYW4+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsb3RPcHRpb25zOiB7XG4gICAgICAgICAgICBwaWU6IHtcbiAgICAgICAgICAgICAgcG9pbnQ6IHtcbiAgICAgICAgICAgICAgICBldmVudHM6IHtcbiAgICAgICAgICAgICAgICAgIGxlZ2VuZEl0ZW1DbGljazogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBlbmFibGVNb3VzZVRyYWNraW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgc2hvd0luTGVnZW5kICA6IHRydWUsXG4gICAgICAgICAgICAgIGlubmVyU2l6ZSAgICAgOiAnNjclJyxcbiAgICAgICAgICAgICAgZGF0YUxhYmVscyAgICA6IHtcbiAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2l6ZToge1xuICAgICAgICAgIGhlaWdodDoyMDBcbiAgICAgICAgfSxcbiAgICAgICAgdGl0bGU6IHt0ZXh0OicnfSxcbiAgICAgICAgc2VyaWVzOiBbe1xuICAgICAgICAgIHR5cGU6J3BpZScsXG4gICAgICAgICAgZGF0YTogW3tuYW1lOidQYXNzZWQnLCB5OnBhc3NlZH0se25hbWU6J0ZhaWxlZCcsIHk6ZmFpbGVkfV1cbiAgICAgICAgfV1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy9pbml0XG4gICAgYWRkQnVpbGQoKTtcbn0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXJBcHAnKS5mYWN0b3J5KCdCdWlsZCcsIGZ1bmN0aW9uKFxuICAkcSxcbiAgJHRpbWVvdXQsXG4gICRpbnRlcnZhbCxcbiAgVXRpbHNcbil7XG4gIHZhclxuICAgIGJ1aWxkSWQgICAgICAgICAgICAgICA9IFV0aWxzLnJhbmRvbU51bWJlcigxMDAwMCksXG4gICAgZmlyZVdhbGxJZCAgICAgICAgICAgID0gVXRpbHMucmFuZG9tTnVtYmVyKDEwMDAwKSxcbiAgICB0b3RhbFVuaXRUZXN0cyAgICAgICAgPSBVdGlscy5yYW5kb21OdW1iZXIoMTAwKSxcbiAgICB0b3RhbEZ1bmN0aW9uYWxUZXN0cyAgPSBVdGlscy5yYW5kb21OdW1iZXIoMTAwMCksXG4gICAgdHlwZXMgICAgICAgICAgICAgICAgID0gWydidWlsZCcsJ2ZpcmV3YWxsJ10sXG4gICAgb3duZXJzICAgICAgICAgICAgICAgID0gWydhbGV4Jywnam9lJywgJ2FkaScsICd3aWxsaWFtJ10sXG4gICAgYnVpbGROYW1lICAgICAgICAgICAgID0gJ3JhaW5tYW4nLFxuICAgIGJ1aWxkbnVtYmVyICAgICAgICAgICA9IDA7XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRCdWlsZDogZ2V0QnVpbGQsXG4gICAgcnVuQnVpbGQ6IHJ1bkJ1aWxkXG4gIH07XG5cbiAgZnVuY3Rpb24gZ2V0QnVpbGQoKXtcbiAgICB2YXIgIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICB2YXJcbiAgICAgICAgdHlwZSAgPSBVdGlscy5nZXRSYW5kb21JdGVtRnJvbUFycmF5KHR5cGVzKSxcbiAgICAgICAgb3duZXIgPSBVdGlscy5nZXRSYW5kb21JdGVtRnJvbUFycmF5KG93bmVycyksXG4gICAgICAgIGJ1aWxkID0ge1xuICAgICAgICAgIGJ1aWxkTnVtYmVyICAgICAgICAgICA6IGJ1aWxkbnVtYmVyLFxuICAgICAgICAgIGlkICAgICAgICAgICAgICAgICAgICA6IHR5cGUgPT09ICdidWlsZCcgPyBidWlsZElkIDogZmlyZVdhbGxJZCxcbiAgICAgICAgICB0eXBlICAgICAgICAgICAgICAgICAgOiB0eXBlLFxuICAgICAgICAgIG5hbWUgICAgICAgICAgICAgICAgICA6IHR5cGUgPT09ICdidWlsZCcgPyBidWlsZE5hbWUgKyAnLScgKyBidWlsZElkIDogZmlyZVdhbGxJZCxcbiAgICAgICAgICBvd25lciAgICAgICAgICAgICAgICAgOiBvd25lcixcbiAgICAgICAgICBkYXRlICAgICAgICAgICAgICAgICAgOiBtb21lbnQoKS5mb3JtYXQoKSxcbiAgICAgICAgICBidWlsZCA6IHtcbiAgICAgICAgICAgIGxhc3RCdWlsZCAgICAgICAgICAgOiBtb21lbnQoKS5zdWJ0cmFjdCgxLCdkYXknKS5mb3JtYXQoKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRvdGFsVW5pdFRlc3RzICAgICAgICA6IHRvdGFsVW5pdFRlc3RzLFxuICAgICAgICAgIHRvdGFsRnVuY3Rpb25hbFRlc3RzICA6IHRvdGFsRnVuY3Rpb25hbFRlc3RzXG4gICAgICAgIH07XG5cbiAgICAgIC8vaW5jcmVtZW50IGlkIG9mIHdpdGhlciBidWlsZCBvciBmaXJld2FsbFxuICAgICAgdHlwZSA9PT0gJ2J1aWxkJyA/IGJ1aWxkSWQrKyA6IGZpcmVXYWxsSWQrKztcbiAgICAgIGJ1aWxkbnVtYmVyKys7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUoYnVpbGQpO1xuXG4gICAgfSw1MDApO1xuXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gIH1cblxuICBmdW5jdGlvbiBydW5CdWlsZChidWlsZCl7XG4gICAgdmFyXG4gICAgICBkZWZlcnJlZCA9ICRxLmRlZmVyKCksXG4gICAgICBrZXlzID0gT2JqZWN0LmtleXMoYnVpbGQucHJvZ3Jlc3MpO1xuXG4gICAgICBydW5TaW11bGF0ZWRQcm9ncmVzcygwKTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgIGZ1bmN0aW9uIHJ1blNpbXVsYXRlZFByb2dyZXNzKGluZGV4KXtcbiAgICAgICAgdmFyXG4gICAgICAgICAgYWN0aXZlUHJvZ3Jlc3NQZXJjZW50LFxuICAgICAgICAgIGFjdGl2ZVByb2dyZXNzO1xuXG4gICAgICAgIGlmIChpbmRleCA8IGtleXMubGVuZ3RoKSB7XG5cbiAgICAgICAgICB2YXIgcHJvZ3Jlc3NJbnRlcnZhbCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIGFjdGl2ZVByb2dyZXNzUGVyY2VudCA9IGJ1aWxkLnByb2dyZXNzW2tleXNbaW5kZXhdXSxcbiAgICAgICAgICAgIGFjdGl2ZVByb2dyZXNzID0ga2V5c1tpbmRleF07XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmVQcm9ncmVzc1BlcmNlbnQgPCAxMDApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkLnByb2dyZXNzW2FjdGl2ZVByb2dyZXNzXSArPSAxO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHByb2dyZXNzSW50ZXJ2YWwpO1xuICAgICAgICAgICAgcmV0dXJuIHJ1blNpbXVsYXRlZFByb2dyZXNzKGluZGV4KzEpO1xuICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShidWlsZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgfVxuXG59KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhbmd1bGFyQXBwJykuZmFjdG9yeSgnVXRpbHMnLCBmdW5jdGlvbigpe1xuICAgdmFyIGZuID0ge1xuICAgIHJhbmRvbU51bWJlcjogcmFuZG9tTnVtYmVyLFxuICAgIGdldFJhbmRvbUl0ZW1Gcm9tQXJyYXk6IGdldFJhbmRvbUl0ZW1Gcm9tQXJyYXlcbiAgfTtcblxuICByZXR1cm4gZm47XG5cbiAgZnVuY3Rpb24gZ2V0UmFuZG9tSXRlbUZyb21BcnJheShhcnJheSkge1xuICAgIHZhciByYW5kb21OdW1iZXIgPSBmbi5yYW5kb21OdW1iZXIoYXJyYXkubGVuZ3RoLTEpO1xuICAgIHJldHVybiBhcnJheVtyYW5kb21OdW1iZXJdO1xuICB9XG4gIGZ1bmN0aW9uIHJhbmRvbU51bWJlcihudW1iZXIpIHtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKm51bWJlcik7XG4gIH1cblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
